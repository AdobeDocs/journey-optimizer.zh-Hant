---
solution: Journey Optimizer
product: journey optimizer
title: 將Journey Optimizer與外部系統整合
description: 在將Journey Optimizer與外部系統整合時瞭解最佳做法
role: User
level: Beginner
keywords: 外部， API，優化程式，上限設定
exl-id: 27859689-dc61-4f7a-b942-431cdf244455
source-git-commit: 609fdb747b1b0f9e18a96f93a4e235d01da8ff72
workflow-type: tm+mt
source-wordcount: '1202'
ht-degree: 32%

---

# 與外部系統整合 {#external-systems}

本頁介紹Journey Optimizer在整合外部系統時提供的不同護欄以及最佳做法：如何使用封頂API優化對外部系統的保護，如何配置行程超時，以及重試如何工作。

Journey Optimizer 可讓您透過自訂資料來源與自訂動作來設定與外部系統的連線。 例如，這允許您使用來自外部預訂系統的資料來豐富您的行程，或使用諸如Epsilon或Facebook等第三方系統發送消息。

在整合外部系統時，可能會遇到一些問題，系統可能速度慢，可能停止響應，或者可能無法處理較大的卷。 Journey Optimizer提供多個護欄，以保護您的系統免受過載。

所有外部系統在效能上都不同。 您需要根據使用案例調整配置。

當Journey Optimizer執行對外部API的調用時，技術護欄按如下方式執行：

1. 應用上限設定或限制規則：如果達到最大速率，則剩餘的呼叫將被丟棄或排隊。

2. 超時並重試：如果滿足上限設定或限制規則，Journey Optimizer將嘗試執行呼叫，直到超時持續時間結束。

## 封頂和限制API {#capping}

### 關於封頂和限制API

當設定資料來源或動作時，您需建立與系統的連線，以擷取要用於歷程的其他資訊，或傳送訊息或 API 呼叫。

歷程 API 每秒最多支援 5000 個事件，但某些外部系統或 API 可能沒有等效的輸送量。為防止超載這些系統，您可以使用 **封頂** 和 **限制** 用於限制每秒發送的事件數的API。

歷程每次執行 API 呼叫時，都會透過 API 引擎。如果達到API中設定的限制，則如果您使用封頂API，則調用將被拒絕；如果您使用限制API，則調用將排隊最多6小時，並按收到的順序盡快進行處理。

例如，假設您已為外部系統定義每秒 100 次呼叫的上限或節流規則。10 個不同歷程的自訂動作會呼叫您的系統。 如果一個歷程每秒收到 200 個呼叫，則將使用 100 個可用插槽，並捨棄或將剩餘的 100 個插槽加入佇列。由於已超過最大速率，其他 9 個歷程將沒有任何插槽。 此詳細程度有助於保護外部系統免於過載及損毀。

>[!IMPORTANT]
>
>**設定上限規則**&#x200B;在沙箱層級針對特定端點 (呼叫的 URL) 進行設定，但會針對該沙箱的所有歷程進行全域設定。
>
>**節流規則**&#x200B;僅在生產沙箱針對特定端點進行設定，但會針對所有沙箱的所有歷程進行全域設定。 每個組織只能有一個節流設定。

有關如何使用API的詳細資訊，請參閱以下各節：

* [設定 API 上限](capping.md)
* [節流 API](throttling.md)

有關API的詳細說明，請參見 [Adobe Journey OptimizerAPI文檔](https://developer.adobe.com/journey-optimizer-apis/references/journeys/)

### 資料來源和自訂動作容量 {#capacity}

對於&#x200B;**外部資料來源**，每秒的呼叫數上限為 15。 如果超過此限制，系統會根據正在使用的 API 將其他呼叫捨棄或排入佇列。可以透過聯絡 Adobe 將端點加入允許清單，以提高這項針對私人外部資料來源的限制，但此選項不適用於公開外部資料來源。* [了解如何設定資料來源](../datasource/about-data-sources.md)。

>[!NOTE]
>
>如果資料來源使用的自訂驗證與用於資料來源的端點不同，則需聯絡 Adobe，以將該端點加入允許清單。

對於&#x200B;**自訂動作**，您需要評估外部 API 的容量。 例如，如果 Journey Optimizer 每秒傳送 1000 次呼叫，而您的系統每秒只支援 100 次呼叫，則您需要定義上限或節流設定，以使系統不會飽和。[了解如何設定動作](../action/action.md)

## 超時和重試次數{#timeout}

如果滿足上限設定或限制規則，則應用超時規則。

在每個行程中，可以定義超時持續時間。 這允許您在調用外部系統時設定最大持續時間。 在行程的屬性中配置超時持續時間。 請參見[此頁面](../building-journeys/journey-gs.md#timeout_and_error)。

此超時對所有外部調用（自定義操作和自定義資料源中的外部API調用）是全局的。 預設情況下，它設定為30秒。

在定義的超時持續時間內，Journey Optimizer嘗試調用外部系統。 在第一次調用之後，最多可執行三次重試，直到達到超時持續時間結束。 無法更改重試次數。

每次重試都使用一個插槽。 如果每秒有100個呼叫的上限，並且每個呼叫需要兩次重試，則速率將降至每秒30個呼叫(每個呼叫使用3個插槽：第一次呼叫和兩次重試)。

超時持續時間值取決於使用案例。 如果想快速發送消息，則不想設定長時間超時。 此外，超時時間越長，排入隊列的項目就越多。 這會大大影響效能。 如果Journey Optimizer每秒執行1000次呼叫，保持5或15秒的資料可能會迅速壓垮系統。

讓我們舉一個超時5秒的示例。

* 第一次呼叫持續時間不到5秒：呼叫成功，未執行重試。
* 第一次呼叫持續時間超過5秒：呼叫已取消，且無重試。 在報告中，它被計為超時錯誤。
* 第一次調用在2秒後失敗（外部系統返回錯誤）:如果有可用的封頂插槽，則剩餘3秒重試。
   * 如果在5秒結束前三次重試中的一次成功，則會執行調用，並且沒有錯誤。
   * 如果在重試期間達到超時持續時間的結束，則取消調用，並將其計為報告中的超時錯誤。

## 常見問答{#faq}

**如何配置上限設定或限制規則？ 是否存在預設規則？**

預設情況下，沒有上限設定或限制規則。 規則在沙盒級別上使用上限設定或限制API為特定終結點（調用的URL）定義。 請參閱[本節](../configuration/external-systems.md#capping)。

**執行了多少次重試？ 是否可以更改重試次數或定義兩次重試之間的最小等待時間？**

對於給定的呼叫，在第一次呼叫之後最多可執行三次重試，直到達到超時持續時間結束。 無法更改重試次數和每次重試之間的時間。 請參閱[本節](../configuration/external-systems.md#timeout)。

**在哪裡可以配置超時？ 有最大值嗎？**

在每個行程中，可以定義超時持續時間。 在行程的屬性中配置超時持續時間。 超時持續時間必須介於1秒和30秒之間。 請參閱 [此部分](../configuration/external-systems.md#timeout) 和 [此頁](../building-journeys/journey-gs.md#timeout_and_error)。