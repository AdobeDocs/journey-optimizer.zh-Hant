---
solution: Journey Optimizer
product: journey optimizer
title: 將Journey Optimizer與外部系統整合
description: 了解將Journey Optimizer與外部系統整合時的最佳實務
role: User
level: Beginner
keywords: 外部， API，優化程式，限定
exl-id: 27859689-dc61-4f7a-b942-431cdf244455
source-git-commit: 65da82fd67442cfa2b5d45ec753fb3c5a86d4cc7
workflow-type: tm+mt
source-wordcount: '1197'
ht-degree: 3%

---

# 與外部系統整合 {#external-systems}

本頁顯示Journey Optimizer在整合外部系統時提供的不同護欄，以及最佳實務：如何使用上限API最佳化對外部系統的保護、如何設定歷程逾時，以及重試的運作方式。

Journey Optimizer 可讓您透過自訂資料來源與自訂動作來設定與外部系統的連線。 舉例來說，這可讓您透過來自外部訂房系統的資料來豐富您的歷程，或使用協力廠商系統(例如Epsilon或Facebook)來傳送訊息。

在整合外部系統時，您可能會遇到幾個問題，系統可能會變慢，可能會停止響應，或者它可能無法處理大容量。 Journey Optimizer提供數個護欄，以保護您的系統不會過度載入。

所有外部系統在效能上都不同。 您需要根據使用案例調整設定。

當Journey Optimizer執行對外部API的呼叫時，技術護欄會如下執行：

1. 套用上限或限制規則：如果達到最大速率，則會捨棄或排入佇列剩餘的呼叫。

2. 超時並重試：如果符合上限規則，Journey Optimizer會嘗試執行呼叫，直到逾時期間結束為止。

## 設定上限與限制API {#capping}

### 關於限定和限制API

設定資料來源或動作時，您需建立與系統的連線，以擷取要用於歷程的其他資訊，或傳送訊息或API呼叫。

Journeys API每秒可支援最多5000個事件，但某些外部系統或API的輸送量可能不相等。 要防止超出這些系統，可以使用 **限定** 和 **節流** 限制每秒傳送事件數的API。

每次由歷程執行API呼叫時，都會通過API引擎。 如果達到API中設定的限制，若您使用上限設定API，則會拒絕呼叫，或如果您使用限制API，則會按照收到的順序盡快排入佇列並處理。

例如，假設您已為外部系統定義每秒100次呼叫的上限或限制規則。 10個不同歷程中的自訂動作會呼叫您的系統。 如果一個歷程每秒收到200個呼叫，則會使用100個可用槽，並捨棄或將剩餘的100個槽加入佇列。 由於超出最大速率，其他9個歷程將沒有任何槽。 此粒度有助於保護外部系統免受過載和崩潰的影響。

>[!IMPORTANT]
>
>**限定規則** 是針對特定端點（稱為的URL），在沙箱層級設定，但會全域覆寫至該沙箱的所有歷程。
>
>**限制規則** 僅在生產沙箱上設定，適用於特定端點，但會針對所有沙箱的所有歷程進行全域設定。 每個組織只能有一個限制配置。

如需如何使用API的詳細資訊，請參閱以下章節：

* [設定API上限](capping.md)
* [限制API](throttling.md)

如需API的詳細說明，請參閱 [Adobe Journey Optimizer API檔案](https://developer.adobe.com/journey-optimizer-apis/references/journeys/)

### 資料來源和自訂動作容量 {#capacity}

針對 **外部資料來源**，每秒的呼叫數上限為15。 如果超過此限制，系統會根據使用中的API捨棄或排入佇列的其他呼叫。 您可以聯絡Adobe將端點納入允許清單，以提高私人外部資料來源的此限制，但此選項不適用於公開外部資料來源。 * [了解如何設定資料來源](../datasource/about-data-sources.md).

>[!NOTE]
>
>如果資料源使用的自定義身份驗證與用於資料源的終結點不同，則需要與Adobe聯繫，以將該終結點包含在允許清單中。

針對 **自訂動作**，您需要評估外部API的容量。 例如，如果Journey Optimizer每秒傳送1000次呼叫，而您的系統每秒只支援100次呼叫，則您需要定義上限或流量設定，以使系統不會飽和。 [了解如何設定動作](../action/action.md)

## 逾時和重試{#timeout}

如果符合上限或限制規則，則會套用逾時規則。

在每個歷程中，您可以定義逾時持續時間。 這可讓您在呼叫外部系統時設定最長持續時間。 逾時期間會在歷程的屬性中設定。 請參見[此頁面](../building-journeys/journey-gs.md#timeout_and_error)。

此逾時對所有外部呼叫（自訂動作和自訂資料來源中的外部API呼叫）都是全域的。 預設會設為30秒。

在定義的逾時期間，Journey Optimizer會嘗試呼叫外部系統。 在首次呼叫後，最多可執行三次重試，直到逾時期間結束為止。 無法更改重試次數。

每次重試都使用一個插槽。 如果您的限定是每秒100個呼叫，且每個呼叫需要兩次重試，則速率會降至每秒30個呼叫(每個呼叫使用3個位置：第一個呼叫和兩次重試)。

逾時持續時間值取決於使用案例。 如果您想要快速傳送訊息（例如當用戶端進入商店時），則不想設定長逾時。 此外，逾時時間越長，排入佇列的項目就越多。 這會大幅影響效能。 如果Journey Optimizer每秒執行1000次呼叫，保留5或15秒的資料可能會迅速壓垮系統。

以5秒的逾時為例。

* 第一次呼叫持續不到5秒：呼叫成功，不執行任何重試。
* 第一次呼叫會持續更長5秒：呼叫已取消，且沒有重試。 在報表中會計為逾時錯誤。
* 第一次呼叫在2秒後失敗（外部系統傳回錯誤）:如果限定槽可用，則剩餘3秒可重試。
   * 如果三次重試之一在5秒結束前成功，則會執行呼叫，且沒有錯誤。
   * 如果重試期間達到逾時期間的結尾，呼叫會取消，並計為報表中的逾時錯誤。

## 常見問答{#faq}

**如何配置限定或限制規則？ 有預設規則嗎？**

預設情況下，沒有限定或限制規則。 規則是使用「上限設定」或「限制API」，在沙箱層級為特定端點（稱為的URL）定義。 請參閱[本節](../configuration/external-systems.md#capping)。

**執行了多少次重試？ 我可以變更重試次數或定義兩次重試之間的最短等待時間嗎？**

對於指定呼叫，在首次呼叫後最多可執行三次重試，直到達到逾時期間的結尾。 無法更改重試次數和每次重試之間的時間。 請參閱[本節](../configuration/external-systems.md#timeout)。

**我可以在何處設定逾時？ 有最大值嗎？**

在每個歷程中，您可以定義逾時持續時間。 逾時期間會在歷程的屬性中設定。 逾時期間必須介於1秒和30秒之間。 請參閱 [本節](../configuration/external-systems.md#timeout) 和 [本頁](../building-journeys/journey-gs.md#timeout_and_error).